/**
 * @description 타임라인은 세션들을 논리적으로 그룹화하는 컨테이너입니다.
 * 예: "2025년 10월", "가을 시즌", "특별 이벤트" 등 세션들을 의미있는 단위로 묶어 관리합니다.
 * @type 추상
 */
model Timeline {
  id          String    @id @default(uuid()) /// 고유 식별자
  seq         Int       @unique @default(autoincrement()) /// 순번
  createdAt   DateTime  @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt   DateTime? @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt   DateTime? @db.Timestamptz(6) /// 삭제 일시
  tenantId    String /// 테넌트 ID
  name        String /// 타임라인 이름 (예: "2025년 10월 첫째 주", "가을 시즌")
  description String? /// 타임라인 설명
  sessions    Session[] /// 세션 목록

  @@index([tenantId])
  @@index([tenantId, createdAt])
  @@index([name])
}

/**
 * @description 세션은 타임라인 내에서 일회성 또는 반복적으로 발생하는 시간 단위 이벤트입니다. 프로그램 실행의 시간적 단위를 나타냅니다.
 * @type 자원
 */
model Session {
  id                 String              @id @default(uuid()) /// 고유 식별자
  seq                Int                 @unique @default(autoincrement()) /// 순번
  createdAt          DateTime            @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt          DateTime?           @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt          DateTime?           @db.Timestamptz(6) /// 삭제 일시
  type               SessionTypes        @default(ONE_TIME) /// 세션 유형 (일회성/기간형/반복형)
  repeatCycleType    RepeatCycleTypes? /// 반복 주기 유형 (주간/월간)
  startDateTime      DateTime?           @db.Timestamptz(6) /// 시작 일시
  endDateTime        DateTime?           @db.Timestamptz(6) /// 종료 일시
  recurringDayOfWeek RecurringDayOfWeek? /// 반복 요일
  timelineId         String /// 타임라인 ID
  name               String /// 세션 이름
  description        String? /// 세션 설명
  programs           Program[] /// 프로그램 목록
  timeline           Timeline            @relation(fields: [timelineId], references: [id]) /// 타임라인 관계

  @@index([timelineId, startDateTime])
  @@index([startDateTime, endDateTime])
  @@index([type, startDateTime])
}

/**
 * @description 프로그램은 특정 세션에서 실행되는 루틴을 나타냅니다. 강사가 진행하는 정원이 정해진 활동 단위입니다.
 * @type 자원
 */
model Program {
  id           String    @id @default(uuid()) /// 고유 식별자
  seq          Int       @unique @default(autoincrement()) /// 순번
  createdAt    DateTime  @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt    DateTime? @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt    DateTime? @db.Timestamptz(6) /// 삭제 일시
  routineId    String /// 루틴 ID
  sessionId    String /// 세션 ID
  instructorId String /// 강사 ID
  capacity     Int /// 정원 (최대 참여 인원)
  name         String /// 프로그램 이름
  level        String? /// 난이도 (초급/중급/고급)
  routine      Routine   @relation(fields: [routineId], references: [id]) /// 루틴 관계
  session      Session   @relation(fields: [sessionId], references: [id]) /// 세션 관계

  @@unique([sessionId, routineId]) /// 같은 세션에서 같은 루틴 중복 방지
  @@index([sessionId])
  @@index([routineId])
  @@index([instructorId])
}

/**
 * @description 루틴은 반복적으로 수행되는 일련의 활동들의 조합입니다. 여러 태스크(Task)들로 구성된 활동 묶음을 의미합니다.
 * @type 자원
 */
model Routine {
  id         String     @id @default(uuid()) /// 고유 식별자
  seq        Int        @unique @default(autoincrement()) /// 순번
  createdAt  DateTime   @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt  DateTime?  @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt  DateTime?  @db.Timestamptz(6) /// 삭제 일시
  name       String /// 이름
  label      String /// 라벨
  programs   Program[] /// 프로그램 목록
  activities Activity[] /// 활동 목록

  @@index([name])
}

/**
 * @description 활동은 루틴 내 태스크의 실행 순서와 방법을 정의합니다. 루틴과 태스크를 연결하며 수행 방식에 대한 메타 정보를 포함합니다.
 * @type 관계
 */
model Activity {
  id          String    @id @default(uuid()) /// 고유 식별자
  seq         Int       @unique @default(autoincrement()) /// 순번
  createdAt   DateTime  @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt   DateTime? @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt   DateTime? @db.Timestamptz(6) /// 삭제 일시
  routineId   String /// 루틴 ID
  taskId      String /// 태스크 ID
  order       Int /// 루틴 내 실행 순서
  repetitions Int       @default(1) /// 반복 횟수 (세트 수)
  restTime    Int       @default(0) /// 다음 운동까지 휴식 시간 (초)
  notes       String? /// 특별 지시사항
  routine     Routine   @relation(fields: [routineId], references: [id]) /// 루틴 관계
  task        Task      @relation(fields: [taskId], references: [id]) /// 태스크 관계

  @@unique([routineId, taskId])
  @@index([routineId, order])
}

/**
 * @description 태스크는 수행해야 할 개별 작업 단위입니다. 운동(Exercise)과 같은 구체적인 활동 내용을 포함합니다.
 * @type 자원
 */
model Task {
  id         String     @id @default(uuid()) /// 고유 식별자
  seq        Int        @unique @default(autoincrement()) /// 순번
  createdAt  DateTime   @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt  DateTime?  @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt  DateTime?  @db.Timestamptz(6) /// 삭제 일시
  tenantId   String /// 테넌트 ID
  activities Activity[] /// 활동 목록
  exercise   Exercise?

  @@index([tenantId])
}

/**
 * @description 운동은 태스크의 구체적인 실행 내용을 정의합니다. 수행 시간, 횟수, 설명 및 관련 미디어 자료를 포함합니다.
 * @type 자원
 */
model Exercise {
  id          String    @id @default(uuid()) /// 고유 식별자
  seq         Int       @unique @default(autoincrement()) /// 순번
  createdAt   DateTime  @default(now()) @db.Timestamptz(6) /// 생성 일시
  updatedAt   DateTime? @updatedAt @db.Timestamptz(6) /// 수정 일시
  removedAt   DateTime? @db.Timestamptz(6) /// 삭제 일시
  duration    Int /// 지속 시간 (초 단위)
  count       Int /// 반복 횟수
  taskId      String    @unique /// 태스크 ID
  description String? /// 운동 설명
  imageFileId String? /// 이미지 파일 ID (운동 동작 이미지)
  videoFileId String? /// 비디오 파일 ID (운동 시연 영상)
  name        String /// 운동 이름
  task        Task      @relation(fields: [taskId], references: [id]) /// 태스크 관계

  @@index([name])
}
